apiVersion: v1
kind: Service
metadata:
  name: appservice-svc
  namespace: default
spec:
  ports:
  - port: 8888
  selector:
    app: appservice
---
apiVersion: v1
kind: Service
metadata:
  name: explorer-svc
  namespace: default
spec:
  ports:
  - port: 8889
  selector:
    app: explorer
---
apiVersion: v1
kind: Service
metadata:
  name: globalrpc-svc
  namespace: default
spec:
  ports:
  - port: 8080
  selector:
    app: globalrpc
---
apiVersion: v1
kind: Service
metadata:
  name: proverhub-svc
  namespace: default
spec:
  ports:
  - port: 38000
  selector:
    app: proverhub
---
apiVersion: v1
kind: Service
metadata:
  name: governancemonitor-svc
  namespace: default
spec:
  ports:
  - port: 39000
  selector:
    app: governancemonitor
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: appservice
  name: appservice
  namespace: default
spec:
  replicas: 1
  revisionHistoryLimit: 5
  selector:
    matchLabels:
      app: appservice
  template:
    metadata:
      labels:
        app: appservice
    spec:
      serviceAccountName: find-endpoints
      containers:
      - image: us-central1-docker.pkg.dev/zecrey-330903/zecrey-webhook/appservice:$TAG_NAME
        imagePullPolicy: Always
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          initialDelaySeconds: 15
          periodSeconds: 20
          tcpSocket:
            port: 8888
        name: appservice
        ports:
        - containerPort: 8888
        readinessProbe:
          initialDelaySeconds: 5
          periodSeconds: 10
          tcpSocket:
            port: 8888
        resources:
          limits:
            cpu: 1000m
            memory: 1024Mi
          requests:
            cpu: 1000m
            memory: 512Mi
        volumeMounts:
        - mountPath: /etc/localtime
          name: timezone
      initContainers:
      - command:
        - sh
        - -c
        - until nslookup globalrpc-svc; do echo waiting for globalrpc; sleep 2; done;
        image: busybox
        name: init-globalrpc
      volumes:
      - hostPath:
          path: /usr/share/zoneinfo/Asia/Shanghai
        name: timezone
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: blockmonitor
  name: blockmonitor
  namespace: default
spec:
  replicas: 1
  revisionHistoryLimit: 5
  selector:
    matchLabels:
      app: blockmonitor
  template:
    metadata:
      labels:
        app: blockmonitor
    spec:
      containers:
      - image: us-central1-docker.pkg.dev/zecrey-330903/zecrey-webhook/blockmonitor:$TAG_NAME
        imagePullPolicy: Always
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        name: blockmonitor
        resources:
          limits:
            cpu: 1000m
            memory: 1024Mi
          requests:
            cpu: 1000m
            memory: 512Mi
        volumeMounts:
        - mountPath: /etc/localtime
          name: timezone
      volumes:
      - hostPath:
          path: /usr/share/zoneinfo/Asia/Shanghai
        name: timezone
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: committer
  name: committer
  namespace: default
spec:
  replicas: 1
  revisionHistoryLimit: 5
  selector:
    matchLabels:
      app: committer
  template:
    metadata:
      labels:
        app: committer
    spec:
      serviceAccountName: find-endpoints
      containers:
      - image: us-central1-docker.pkg.dev/zecrey-330903/zecrey-webhook/committer:$TAG_NAME
        imagePullPolicy: Always
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        name: committer
        resources:
          limits:
            cpu: 1000m
            memory: 1024Mi
          requests:
            cpu: 1000m
            memory: 512Mi
        volumeMounts:
        - mountPath: /etc/localtime
          name: timezone
      volumes:
      - hostPath:
          path: /usr/share/zoneinfo/Asia/Shanghai
        name: timezone
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: explorer
  name: explorer
  namespace: default
spec:
  replicas: 1
  revisionHistoryLimit: 5
  selector:
    matchLabels:
      app: explorer
  template:
    metadata:
      labels:
        app: explorer
    spec:
      serviceAccountName: find-endpoints
      containers:
      - image: us-central1-docker.pkg.dev/zecrey-330903/zecrey-webhook/explorer:$TAG_NAME
        imagePullPolicy: Always
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          initialDelaySeconds: 15
          periodSeconds: 20
          tcpSocket:
            port: 8889
        name: explorer
        ports:
        - containerPort: 8889
        readinessProbe:
          initialDelaySeconds: 5
          periodSeconds: 10
          tcpSocket:
            port: 8889
        resources:
          limits:
            cpu: 1000m
            memory: 1024Mi
          requests:
            cpu: 1000m
            memory: 512Mi
        volumeMounts:
        - mountPath: /etc/localtime
          name: timezone
      initContainers:
      - command:
        - sh
        - -c
        - until nslookup globalrpc-svc; do echo waiting for globalrpc; sleep 2; done;
        image: busybox
        name: init-globalrpc
      volumes:
      - hostPath:
          path: /usr/share/zoneinfo/Asia/Shanghai
        name: timezone
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: globalrpc
  name: globalrpc
  namespace: default
spec:
  replicas: 1
  revisionHistoryLimit: 5
  selector:
    matchLabels:
      app: globalrpc
  template:
    metadata:
      labels:
        app: globalrpc
    spec:
      containers:
      - image: us-central1-docker.pkg.dev/zecrey-330903/zecrey-webhook/globalrpc:$TAG_NAME
        imagePullPolicy: Always
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          initialDelaySeconds: 15
          periodSeconds: 20
          tcpSocket:
            port: 8080
        name: globalrpc
        ports:
        - containerPort: 8080
        readinessProbe:
          initialDelaySeconds: 5
          periodSeconds: 10
          tcpSocket:
            port: 8080
        resources:
          limits:
            cpu: 1000m
            memory: 1024Mi
          requests:
            cpu: 1000m
            memory: 512Mi
        volumeMounts:
        - mountPath: /etc/localtime
          name: timezone
      volumes:
      - hostPath:
          path: /usr/share/zoneinfo/Asia/Shanghai
        name: timezone
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: l2blockmonitor
  name: l2blockmonitor
  namespace: default
spec:
  replicas: 1
  revisionHistoryLimit: 5
  selector:
    matchLabels:
      app: l2blockmonitor
  template:
    metadata:
      labels:
        app: l2blockmonitor
    spec:
      containers:
      - image: us-central1-docker.pkg.dev/zecrey-330903/zecrey-webhook/l2blockmonitor:$TAG_NAME
        imagePullPolicy: Always
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        name: l2blockmonitor
        resources:
          limits:
            cpu: 1000m
            memory: 1024Mi
          requests:
            cpu: 1000m
            memory: 512Mi
        volumeMounts:
        - mountPath: /etc/localtime
          name: timezone
      volumes:
      - hostPath:
          path: /usr/share/zoneinfo/Asia/Shanghai
        name: timezone
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: mempoolmonitor
  name: mempoolmonitor
  namespace: default
spec:
  replicas: 1
  revisionHistoryLimit: 5
  selector:
    matchLabels:
      app: mempoolmonitor
  template:
    metadata:
      labels:
        app: mempoolmonitor
    spec:
      serviceAccountName: find-endpoints
      containers:
      - image: us-central1-docker.pkg.dev/zecrey-330903/zecrey-webhook/mempoolmonitor:$TAG_NAME
        imagePullPolicy: Always
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        name: mempoolmonitor
        resources:
          limits:
            cpu: 1000m
            memory: 1024Mi
          requests:
            cpu: 1000m
            memory: 512Mi
        volumeMounts:
        - mountPath: /etc/localtime
          name: timezone
      volumes:
      - hostPath:
          path: /usr/share/zoneinfo/Asia/Shanghai
        name: timezone
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: proverclient
  name: proverclient
  namespace: default
spec:
  replicas: 1
  revisionHistoryLimit: 5
  selector:
    matchLabels:
      app: proverclient
  template:
    metadata:
      labels:
        app: proverclient
    spec:
      serviceAccountName: find-endpoints
      containers:
      - image: us-central1-docker.pkg.dev/zecrey-330903/zecrey-webhook/proverclient:$TAG_NAME
        imagePullPolicy: Always
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        name: proverclient
        resources:
          limits:
            cpu: 2000m
            memory: 8192Mi
          requests:
            cpu: 1000m
            memory: 8192Mi
        volumeMounts:
        - mountPath: /etc/localtime
          name: timezone
      initContainers:
      - command:
        - sh
        - -c
        - sleep 120 && until nslookup proverhub-svc; do echo waiting for proverhub;
          sleep 2; done;
        image: busybox
        name: init-proverhub
      volumes:
      - hostPath:
          path: /usr/share/zoneinfo/Asia/Shanghai
        name: timezone
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: proverhub
  name: proverhub
  namespace: default
spec:
  replicas: 1
  revisionHistoryLimit: 5
  selector:
    matchLabels:
      app: proverhub
  template:
    metadata:
      labels:
        app: proverhub
    spec:
      containers:
      - image: us-central1-docker.pkg.dev/zecrey-330903/zecrey-webhook/proverhub:$TAG_NAME
        imagePullPolicy: Always
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          initialDelaySeconds: 15
          periodSeconds: 20
          tcpSocket:
            port: 38000
        name: proverhub
        ports:
        - containerPort: 38000
        readinessProbe:
          initialDelaySeconds: 5
          periodSeconds: 10
          tcpSocket:
            port: 38000
        resources:
          limits:
            cpu: 1000m
            memory: 1024Mi
          requests:
            cpu: 1000m
            memory: 512Mi
        volumeMounts:
        - mountPath: /etc/localtime
          name: timezone
      volumes:
      - hostPath:
          path: /usr/share/zoneinfo/Asia/Shanghai
        name: timezone
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: sender
  name: sender
  namespace: default
spec:
  replicas: 1
  revisionHistoryLimit: 5
  selector:
    matchLabels:
      app: sender
  template:
    metadata:
      labels:
        app: sender
    spec:
      containers:
      - image: us-central1-docker.pkg.dev/zecrey-330903/zecrey-webhook/sender:$TAG_NAME
        imagePullPolicy: Always
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        name: sender
        resources:
          limits:
            cpu: 1000m
            memory: 1024Mi
          requests:
            cpu: 1000m
            memory: 512Mi
        volumeMounts:
        - mountPath: /etc/localtime
          name: timezone
      volumes:
      - hostPath:
          path: /usr/share/zoneinfo/Asia/Shanghai
        name: timezone
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: governancemonitor
  name: governancemonitor
  namespace: default
spec:
  replicas: 1
  revisionHistoryLimit: 5
  selector:
    matchLabels:
      app: governancemonitor
  template:
    metadata:
      labels:
        app: governancemonitor
    spec:
      containers:
      - image: us-central1-docker.pkg.dev/zecrey-330903/zecrey-webhook/governancemonitor:$TAG_NAME
        imagePullPolicy: Always
        lifecycle:
          preStop:
            exec:
              command:
              - sh
              - -c
              - sleep 5
        livenessProbe:
          initialDelaySeconds: 15
          periodSeconds: 20
          tcpSocket:
            port: 39000
        name: governancemonitor
        ports:
        - containerPort: 39000
        readinessProbe:
          initialDelaySeconds: 5
          periodSeconds: 10
          tcpSocket:
            port: 39000
        resources:
          limits:
            cpu: 1000m
            memory: 1024Mi
          requests:
            cpu: 1000m
            memory: 512Mi
        volumeMounts:
        - mountPath: /etc/localtime
          name: timezone
      volumes:
      - hostPath:
          path: /usr/share/zoneinfo/Asia/Shanghai
        name: timezone
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: appservice-hpa-c
  name: appservice-hpa-c
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: cpu
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: appservice
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: appservice-hpa-m
  name: appservice-hpa-m
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: memory
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: appservice
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: blockmonitor
  name: blockmonitor
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: cpu
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: blockmonitor
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: blockmonitor
  name: blockmonitor
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: memory
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: blockmonitor
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: committer-hpa-c
  name: committer-hpa-c
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: cpu
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: committer
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: committer-hpa-m
  name: committer-hpa-m
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: memory
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: committer
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: explorer-hpa-c
  name: explorer-hpa-c
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: cpu
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: explorer
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: explorer-hpa-m
  name: explorer-hpa-m
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: memory
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: explorer
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: globalrpc-hpa-c
  name: globalrpc-hpa-c
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: cpu
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: globalrpc
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: globalrpc-hpa-m
  name: globalrpc-hpa-m
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: memory
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: globalrpc
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: l2blockmonitor-hpa-c
  name: l2blockmonitor-hpa-c
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: cpu
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: l2blockmonitor
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: l2blockmonitor-hpa-m
  name: l2blockmonitor-hpa-m
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: memory
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: l2blockmonitor
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: mempoolmonitor-hpa-c
  name: mempoolmonitor-hpa-c
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: cpu
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: mempoolmonitor
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: mempoolmonitor-hpa-m
  name: mempoolmonitor-hpa-m
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: memory
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: mempoolmonitor
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: proverclient-hpa-c
  name: proverclient-hpa-c
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: cpu
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: proverclient
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: proverclient-hpa-m
  name: proverclient-hpa-m
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: memory
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: proverclient
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: proverhub-hpa-c
  name: proverhub-hpa-c
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: cpu
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: proverhub
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: proverhub-hpa-m
  name: proverhub-hpa-m
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: memory
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: proverhub
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: sender
  name: sender
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: cpu
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: sender
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: sender
  name: sender
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: memory
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: sender
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: governancemonitor-hpa-c
  name: governancemonitor-hpa-c
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: cpu
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: governancemonitor
---
apiVersion: autoscaling/v2beta1
kind: HorizontalPodAutoscaler
metadata:
  labels:
    app: governancemonitor-hpa-m
  name: governancemonitor-hpa-m
  namespace: default
spec:
  maxReplicas: 1
  metrics:
  - resource:
      name: memory
      targetAverageUtilization: 80
    type: Resource
  minReplicas: 1
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: governancemonitor